{"test_class": {"identifier": "CustomSecureSerializerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private CustomSecureSerializer serializer;", "modifier": "private", "type": "CustomSecureSerializer", "declarator": "serializer", "var_name": "serializer"}, {"original_string": "private JsonGenerator jsonGenerator;", "modifier": "private", "type": "JsonGenerator", "declarator": "jsonGenerator", "var_name": "jsonGenerator"}], "file": "hdiv-services/src/test/java/org/hdiv/services/CustomSecureSerializerTest.java"}, "test_case": {"identifier": "beanSerializationTest", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n\tpublic void beanSerializationTest() throws Exception {\n\t\tserializer.serialize(new TestBean(1L, \"testValue1\", \"testValue2\"), jsonGenerator, null);\n\t\tverify(jsonGenerator).writeFieldName(\"otherAttr\");\n\t\tverify(jsonGenerator).writeFieldName(\"otherAttr2\");\n\t\tverify(jsonGenerator).writeObject(1L);\n\t\tverify(jsonGenerator).writeObject(\"testValue1\");\n\t\tverify(jsonGenerator).writeObject(\"testValue2\");\n\t\tverify(jsonGenerator, times(3)).writeFieldName(anyString());\n\t\tverify(jsonGenerator, times(3)).writeObject(Mockito.any());\n\n\t}", "signature": "void beanSerializationTest()", "full_signature": "@Test public void beanSerializationTest()", "class_method_signature": "CustomSecureSerializerTest.beanSerializationTest()", "testcase": true, "constructor": false, "invocations": ["serialize", "writeFieldName", "verify", "writeFieldName", "verify", "writeObject", "verify", "writeObject", "verify", "writeObject", "verify", "writeFieldName", "verify", "times", "anyString", "writeObject", "verify", "times", "any"]}, "focal_class": {"identifier": "CustomSecureSerializer", "superclass": "extends JsonSerializer<Object>", "interfaces": "", "fields": [{"original_string": "private JsonSerializer<Object> delegatedSerializer;", "modifier": "private", "type": "JsonSerializer<Object>", "declarator": "delegatedSerializer", "var_name": "delegatedSerializer"}, {"original_string": "private final Map<String, JsonSerializer<Object>> secureIdSerializer = new HashMap<String, JsonSerializer<Object>>();", "modifier": "private final", "type": "Map<String, JsonSerializer<Object>>", "declarator": "secureIdSerializer = new HashMap<String, JsonSerializer<Object>>()", "var_name": "secureIdSerializer"}, {"original_string": "private JsonGenerator jsonGen = null;", "modifier": "private", "type": "JsonGenerator", "declarator": "jsonGen = null", "var_name": "jsonGen"}, {"original_string": "private SerializerProvider jsonProvider = null;", "modifier": "private", "type": "SerializerProvider", "declarator": "jsonProvider = null", "var_name": "jsonProvider"}], "methods": [{"identifier": "setDelegatedSerializer", "parameters": "(final JsonSerializer<Object> delegatedSerializer)", "modifiers": "public", "return": "void", "signature": "void setDelegatedSerializer(final JsonSerializer<Object> delegatedSerializer)", "full_signature": "public void setDelegatedSerializer(final JsonSerializer<Object> delegatedSerializer)", "class_method_signature": "CustomSecureSerializer.setDelegatedSerializer(final JsonSerializer<Object> delegatedSerializer)", "testcase": false, "constructor": false}, {"identifier": "serialize", "parameters": "(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "modifiers": "@SuppressWarnings({ \"rawtypes\", \"unchecked\" }) @Override public final", "return": "void", "signature": "void serialize(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "full_signature": "@SuppressWarnings({ \"rawtypes\", \"unchecked\" }) @Override public final void serialize(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "class_method_signature": "CustomSecureSerializer.serialize(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "testcase": false, "constructor": false}, {"identifier": "getIdentityField", "parameters": "(final Object obj)", "modifiers": "private", "return": "Field", "signature": "Field getIdentityField(final Object obj)", "full_signature": "private Field getIdentityField(final Object obj)", "class_method_signature": "CustomSecureSerializer.getIdentityField(final Object obj)", "testcase": false, "constructor": false}, {"identifier": "writeBody", "parameters": "(final Object obj)", "modifiers": "protected abstract", "return": "void", "signature": "void writeBody(final Object obj)", "full_signature": "protected abstract void writeBody(final Object obj)", "class_method_signature": "CustomSecureSerializer.writeBody(final Object obj)", "testcase": false, "constructor": false}, {"identifier": "writeField", "parameters": "(final BeanWrapper beanWrapper, final String propertyName, final boolean nullValueAsBlank)", "modifiers": "protected", "return": "void", "signature": "void writeField(final BeanWrapper beanWrapper, final String propertyName, final boolean nullValueAsBlank)", "full_signature": "protected void writeField(final BeanWrapper beanWrapper, final String propertyName, final boolean nullValueAsBlank)", "class_method_signature": "CustomSecureSerializer.writeField(final BeanWrapper beanWrapper, final String propertyName, final boolean nullValueAsBlank)", "testcase": false, "constructor": false}, {"identifier": "writeField", "parameters": "(final BeanWrapper beanWrapper, final String tagName, final String propertyName,\n\t\t\tfinal boolean nullValueAsBlank)", "modifiers": "protected", "return": "void", "signature": "void writeField(final BeanWrapper beanWrapper, final String tagName, final String propertyName,\n\t\t\tfinal boolean nullValueAsBlank)", "full_signature": "protected void writeField(final BeanWrapper beanWrapper, final String tagName, final String propertyName,\n\t\t\tfinal boolean nullValueAsBlank)", "class_method_signature": "CustomSecureSerializer.writeField(final BeanWrapper beanWrapper, final String tagName, final String propertyName,\n\t\t\tfinal boolean nullValueAsBlank)", "testcase": false, "constructor": false}, {"identifier": "getBeanProperty", "parameters": "(final String name, final Object value, final TrustAssertion trustAssertion, final Class<?> type)", "modifiers": "private", "return": "BeanProperty", "signature": "BeanProperty getBeanProperty(final String name, final Object value, final TrustAssertion trustAssertion, final Class<?> type)", "full_signature": "private BeanProperty getBeanProperty(final String name, final Object value, final TrustAssertion trustAssertion, final Class<?> type)", "class_method_signature": "CustomSecureSerializer.getBeanProperty(final String name, final Object value, final TrustAssertion trustAssertion, final Class<?> type)", "testcase": false, "constructor": false}], "file": "hdiv-services/src/main/java/org/hdiv/services/CustomSecureSerializer.java"}, "focal_method": {"identifier": "serialize", "parameters": "(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "modifiers": "@SuppressWarnings({ \"rawtypes\", \"unchecked\" }) @Override public final", "return": "void", "body": "@SuppressWarnings({ \"rawtypes\", \"unchecked\" })\n\t@Override\n\tpublic final void serialize(final Object object, final JsonGenerator jgen, final SerializerProvider provider)\n\t\t\tthrows IOException, JsonProcessingException {\n\n\t\tjsonGen = jgen;\n\t\tjsonProvider = provider;\n\n\t\tboolean flushEnabled = jsonGen.isEnabled(Feature.FLUSH_PASSED_TO_STREAM);\n\n\t\tjsonGen.disable(Feature.FLUSH_PASSED_TO_STREAM);\n\n\t\tjsonGen.writeStartObject();\n\n\t\tif (delegatedSerializer != null) {\n\t\t\tString secureIdName = null;\n\t\t\tObject value = null;\n\t\t\tif (object instanceof SecureIdentifiable<?>) {\n\t\t\t\tif (delegatedSerializer instanceof ContextualSerializer) {\n\t\t\t\t\tsecureIdName = \"id\";\n\t\t\t\t\tvalue = ((SecureIdentifiable) object).getId();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tField identifiableField = getIdentityField(object);\n\t\t\t\t\t\tJsonSerializer<Object> efective = (JsonSerializer<Object>) ((ContextualSerializer) delegatedSerializer)\n\t\t\t\t\t\t\t\t.createContextual(provider, getBeanProperty(secureIdName, value, null,\n\t\t\t\t\t\t\t\t\t\tidentifiableField != null ? identifiableField.getType() : null));\n\t\t\t\t\t\tsecureIdSerializer.put(secureIdName, efective);\n\t\t\t\t\t\tif (jsonGen.getCurrentValue() == null) {\n\t\t\t\t\t\t\tjsonGen.setCurrentValue(object);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcatch (Exception e) {\n\t\t\t\t\t\t// Error getting id of the object. Do not make any task to preserve the original functionality\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (object instanceof SecureIdContainer) {\n\t\t\t\tfor (Field field : object.getClass().getDeclaredFields()) {\n\t\t\t\t\tTrustAssertion trustAssertion = field.getAnnotation(TrustAssertion.class);\n\t\t\t\t\tif (trustAssertion != null) {\n\t\t\t\t\t\tif (delegatedSerializer instanceof ContextualSerializer) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tfield.setAccessible(true);\n\t\t\t\t\t\t\t\tsecureIdName = field.getName();\n\t\t\t\t\t\t\t\tvalue = field.get(object);\n\n\t\t\t\t\t\t\t\tif (delegatedSerializer instanceof ContextualSerializer) {\n\t\t\t\t\t\t\t\t\tJsonSerializer<Object> efective = ((JsonSerializer<Object>) ((ContextualSerializer) delegatedSerializer)\n\t\t\t\t\t\t\t\t\t\t\t.createContextual(provider,\n\t\t\t\t\t\t\t\t\t\t\t\t\tgetBeanProperty(secureIdName, value, trustAssertion, field.getType())));\n\t\t\t\t\t\t\t\t\tsecureIdSerializer.put(secureIdName, efective);\n\t\t\t\t\t\t\t\t\tif (jsonGen.getCurrentValue() == null) {\n\t\t\t\t\t\t\t\t\t\tjsonGen.setCurrentValue(object);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcatch (Exception e) {\n\t\t\t\t\t\t\t\t// Error getting id of the object. Do not make any task to preserve the original functionality\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\twriteBody(object);\n\n\t\tif (flushEnabled) {\n\t\t\tjsonGen.enable(Feature.FLUSH_PASSED_TO_STREAM);\n\t\t}\n\n\t\tjsonGen.writeEndObject();\n\n\t}", "signature": "void serialize(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "full_signature": "@SuppressWarnings({ \"rawtypes\", \"unchecked\" }) @Override public final void serialize(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "class_method_signature": "CustomSecureSerializer.serialize(final Object object, final JsonGenerator jgen, final SerializerProvider provider)", "testcase": false, "constructor": false, "invocations": ["isEnabled", "disable", "writeStartObject", "getId", "getIdentityField", "createContextual", "getBeanProperty", "getType", "put", "getCurrentValue", "setCurrentValue", "getDeclaredFields", "getClass", "getAnnotation", "setAccessible", "getName", "get", "createContextual", "getBeanProperty", "getType", "put", "getCurrentValue", "setCurrentValue", "writeBody", "enable", "writeEndObject"]}, "repository": {"repo_id": 2626654, "url": "https://github.com/hdiv/hdiv", "language": "Java", "is_fork": false, "fork_count": 56, "stargazer_count": 187, "size": 4015, "license": "licensed"}}