{"test_class": {"identifier": "GoogleTaskLogsTest", "superclass": "extends EasyMockSupport", "interfaces": "", "fields": [{"original_string": "private static final String KEY_1 = \"key1\";", "modifier": "private static final", "type": "String", "declarator": "KEY_1 = \"key1\"", "var_name": "KEY_1"}, {"original_string": "private static final String KEY_2 = \"key2\";", "modifier": "private static final", "type": "String", "declarator": "KEY_2 = \"key2\"", "var_name": "KEY_2"}, {"original_string": "private static final String BUCKET = \"test\";", "modifier": "private static final", "type": "String", "declarator": "BUCKET = \"test\"", "var_name": "BUCKET"}, {"original_string": "private static final String PREFIX = \"test/log\";", "modifier": "private static final", "type": "String", "declarator": "PREFIX = \"test/log\"", "var_name": "PREFIX"}, {"original_string": "private static final URI PREFIX_URI = URI.create(StringUtils.format(\"gs://%s/%s\", BUCKET, PREFIX));", "modifier": "private static final", "type": "URI", "declarator": "PREFIX_URI = URI.create(StringUtils.format(\"gs://%s/%s\", BUCKET, PREFIX))", "var_name": "PREFIX_URI"}, {"original_string": "private static final String TASKID = \"taskid\";", "modifier": "private static final", "type": "String", "declarator": "TASKID = \"taskid\"", "var_name": "TASKID"}, {"original_string": "private static final long TIME_0 = 0L;", "modifier": "private static final", "type": "long", "declarator": "TIME_0 = 0L", "var_name": "TIME_0"}, {"original_string": "private static final long TIME_1 = 1L;", "modifier": "private static final", "type": "long", "declarator": "TIME_1 = 1L", "var_name": "TIME_1"}, {"original_string": "private static final long TIME_NOW = 2L;", "modifier": "private static final", "type": "long", "declarator": "TIME_NOW = 2L", "var_name": "TIME_NOW"}, {"original_string": "private static final long TIME_FUTURE = 3L;", "modifier": "private static final", "type": "long", "declarator": "TIME_FUTURE = 3L", "var_name": "TIME_FUTURE"}, {"original_string": "private static final int MAX_KEYS = 1;", "modifier": "private static final", "type": "int", "declarator": "MAX_KEYS = 1", "var_name": "MAX_KEYS"}, {"original_string": "private static final Exception RECOVERABLE_EXCEPTION = new HttpResponseException.Builder(429, \"recoverable\", new HttpHeaders()).build();", "modifier": "private static final", "type": "Exception", "declarator": "RECOVERABLE_EXCEPTION = new HttpResponseException.Builder(429, \"recoverable\", new HttpHeaders()).build()", "var_name": "RECOVERABLE_EXCEPTION"}, {"original_string": "private static final Exception NON_RECOVERABLE_EXCEPTION = new HttpResponseException.Builder(404, \"non recoverable\", new HttpHeaders()).build();", "modifier": "private static final", "type": "Exception", "declarator": "NON_RECOVERABLE_EXCEPTION = new HttpResponseException.Builder(404, \"non recoverable\", new HttpHeaders()).build()", "var_name": "NON_RECOVERABLE_EXCEPTION"}, {"original_string": "private GoogleStorage storage;", "modifier": "private", "type": "GoogleStorage", "declarator": "storage", "var_name": "storage"}, {"original_string": "private GoogleTaskLogs googleTaskLogs;", "modifier": "private", "type": "GoogleTaskLogs", "declarator": "googleTaskLogs", "var_name": "googleTaskLogs"}, {"original_string": "private GoogleTaskLogsConfig config;", "modifier": "private", "type": "GoogleTaskLogsConfig", "declarator": "config", "var_name": "config"}, {"original_string": "private GoogleInputDataConfig inputDataConfig;", "modifier": "private", "type": "GoogleInputDataConfig", "declarator": "inputDataConfig", "var_name": "inputDataConfig"}, {"original_string": "private CurrentTimeMillisSupplier timeSupplier;", "modifier": "private", "type": "CurrentTimeMillisSupplier", "declarator": "timeSupplier", "var_name": "timeSupplier"}], "file": "extensions-core/google-extensions/src/test/java/org/apache/druid/storage/google/GoogleTaskLogsTest.java"}, "test_case": {"identifier": "test_killAll_nonrecoverableExceptionWhenListingObjects_doesntDeleteAnyTaskLogs", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void test_killAll_nonrecoverableExceptionWhenListingObjects_doesntDeleteAnyTaskLogs()\n  {\n    boolean ioExceptionThrown = false;\n    Storage.Objects.List listRequest = null;\n    try {\n      StorageObject object1 = GoogleTestUtils.newStorageObject(BUCKET, KEY_1, TIME_0);\n\n      EasyMock.expect(timeSupplier.getAsLong()).andReturn(TIME_NOW);\n\n      listRequest = GoogleTestUtils.expectListRequest(storage, PREFIX_URI);\n\n      GoogleTestUtils.expectListObjects(\n          listRequest,\n          PREFIX_URI,\n          MAX_KEYS,\n          ImmutableList.of(object1)\n      );\n\n      GoogleTestUtils.expectDeleteObjects(\n          storage,\n          ImmutableList.of(),\n          ImmutableMap.of(object1, NON_RECOVERABLE_EXCEPTION)\n      );\n\n      EasyMock.expect(inputDataConfig.getMaxListingLength()).andReturn(MAX_KEYS);\n\n      EasyMock.replay(listRequest, inputDataConfig, storage, timeSupplier);\n\n      googleTaskLogs.killAll();\n    }\n    catch (IOException e) {\n      ioExceptionThrown = true;\n    }\n\n    Assert.assertTrue(ioExceptionThrown);\n\n    EasyMock.verify(listRequest, inputDataConfig, storage, timeSupplier);\n  }", "signature": "void test_killAll_nonrecoverableExceptionWhenListingObjects_doesntDeleteAnyTaskLogs()", "full_signature": "@Test public void test_killAll_nonrecoverableExceptionWhenListingObjects_doesntDeleteAnyTaskLogs()", "class_method_signature": "GoogleTaskLogsTest.test_killAll_nonrecoverableExceptionWhenListingObjects_doesntDeleteAnyTaskLogs()", "testcase": true, "constructor": false, "invocations": ["newStorageObject", "andReturn", "expect", "getAsLong", "expectListRequest", "expectListObjects", "of", "expectDeleteObjects", "of", "of", "andReturn", "expect", "getMaxListingLength", "replay", "killAll", "assertTrue", "verify"]}, "focal_class": {"identifier": "GoogleTaskLogs", "superclass": "", "interfaces": "implements TaskLogs", "fields": [{"original_string": "private static final Logger LOG = new Logger(GoogleTaskLogs.class);", "modifier": "private static final", "type": "Logger", "declarator": "LOG = new Logger(GoogleTaskLogs.class)", "var_name": "LOG"}, {"original_string": "private final GoogleTaskLogsConfig config;", "modifier": "private final", "type": "GoogleTaskLogsConfig", "declarator": "config", "var_name": "config"}, {"original_string": "private final GoogleStorage storage;", "modifier": "private final", "type": "GoogleStorage", "declarator": "storage", "var_name": "storage"}, {"original_string": "private final GoogleInputDataConfig inputDataConfig;", "modifier": "private final", "type": "GoogleInputDataConfig", "declarator": "inputDataConfig", "var_name": "inputDataConfig"}, {"original_string": "private final CurrentTimeMillisSupplier timeSupplier;", "modifier": "private final", "type": "CurrentTimeMillisSupplier", "declarator": "timeSupplier", "var_name": "timeSupplier"}], "methods": [{"identifier": "GoogleTaskLogs", "parameters": "(\n      GoogleTaskLogsConfig config,\n      GoogleStorage storage,\n      GoogleInputDataConfig inputDataConfig,\n      CurrentTimeMillisSupplier timeSupplier\n  )", "modifiers": "@Inject public", "return": "", "signature": " GoogleTaskLogs(\n      GoogleTaskLogsConfig config,\n      GoogleStorage storage,\n      GoogleInputDataConfig inputDataConfig,\n      CurrentTimeMillisSupplier timeSupplier\n  )", "full_signature": "@Inject public  GoogleTaskLogs(\n      GoogleTaskLogsConfig config,\n      GoogleStorage storage,\n      GoogleInputDataConfig inputDataConfig,\n      CurrentTimeMillisSupplier timeSupplier\n  )", "class_method_signature": "GoogleTaskLogs.GoogleTaskLogs(\n      GoogleTaskLogsConfig config,\n      GoogleStorage storage,\n      GoogleInputDataConfig inputDataConfig,\n      CurrentTimeMillisSupplier timeSupplier\n  )", "testcase": false, "constructor": true}, {"identifier": "pushTaskLog", "parameters": "(final String taskid, final File logFile)", "modifiers": "@Override public", "return": "void", "signature": "void pushTaskLog(final String taskid, final File logFile)", "full_signature": "@Override public void pushTaskLog(final String taskid, final File logFile)", "class_method_signature": "GoogleTaskLogs.pushTaskLog(final String taskid, final File logFile)", "testcase": false, "constructor": false}, {"identifier": "pushTaskReports", "parameters": "(String taskid, File reportFile)", "modifiers": "@Override public", "return": "void", "signature": "void pushTaskReports(String taskid, File reportFile)", "full_signature": "@Override public void pushTaskReports(String taskid, File reportFile)", "class_method_signature": "GoogleTaskLogs.pushTaskReports(String taskid, File reportFile)", "testcase": false, "constructor": false}, {"identifier": "pushTaskFile", "parameters": "(final File logFile, final String taskKey)", "modifiers": "private", "return": "void", "signature": "void pushTaskFile(final File logFile, final String taskKey)", "full_signature": "private void pushTaskFile(final File logFile, final String taskKey)", "class_method_signature": "GoogleTaskLogs.pushTaskFile(final File logFile, final String taskKey)", "testcase": false, "constructor": false}, {"identifier": "streamTaskLog", "parameters": "(final String taskid, final long offset)", "modifiers": "@Override public", "return": "Optional<ByteSource>", "signature": "Optional<ByteSource> streamTaskLog(final String taskid, final long offset)", "full_signature": "@Override public Optional<ByteSource> streamTaskLog(final String taskid, final long offset)", "class_method_signature": "GoogleTaskLogs.streamTaskLog(final String taskid, final long offset)", "testcase": false, "constructor": false}, {"identifier": "streamTaskReports", "parameters": "(String taskid)", "modifiers": "@Override public", "return": "Optional<ByteSource>", "signature": "Optional<ByteSource> streamTaskReports(String taskid)", "full_signature": "@Override public Optional<ByteSource> streamTaskReports(String taskid)", "class_method_signature": "GoogleTaskLogs.streamTaskReports(String taskid)", "testcase": false, "constructor": false}, {"identifier": "streamTaskFile", "parameters": "(final String taskid, final long offset, String taskKey)", "modifiers": "private", "return": "Optional<ByteSource>", "signature": "Optional<ByteSource> streamTaskFile(final String taskid, final long offset, String taskKey)", "full_signature": "private Optional<ByteSource> streamTaskFile(final String taskid, final long offset, String taskKey)", "class_method_signature": "GoogleTaskLogs.streamTaskFile(final String taskid, final long offset, String taskKey)", "testcase": false, "constructor": false}, {"identifier": "getTaskLogKey", "parameters": "(String taskid)", "modifiers": "private", "return": "String", "signature": "String getTaskLogKey(String taskid)", "full_signature": "private String getTaskLogKey(String taskid)", "class_method_signature": "GoogleTaskLogs.getTaskLogKey(String taskid)", "testcase": false, "constructor": false}, {"identifier": "getTaskReportKey", "parameters": "(String taskid)", "modifiers": "private", "return": "String", "signature": "String getTaskReportKey(String taskid)", "full_signature": "private String getTaskReportKey(String taskid)", "class_method_signature": "GoogleTaskLogs.getTaskReportKey(String taskid)", "testcase": false, "constructor": false}, {"identifier": "killAll", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void killAll()", "full_signature": "@Override public void killAll()", "class_method_signature": "GoogleTaskLogs.killAll()", "testcase": false, "constructor": false}, {"identifier": "killOlderThan", "parameters": "(long timestamp)", "modifiers": "@Override public", "return": "void", "signature": "void killOlderThan(long timestamp)", "full_signature": "@Override public void killOlderThan(long timestamp)", "class_method_signature": "GoogleTaskLogs.killOlderThan(long timestamp)", "testcase": false, "constructor": false}], "file": "extensions-core/google-extensions/src/main/java/org/apache/druid/storage/google/GoogleTaskLogs.java"}, "focal_method": {"identifier": "killAll", "parameters": "()", "modifiers": "@Override public", "return": "void", "body": "@Override\n  public void killAll() throws IOException\n  {\n    LOG.info(\n        \"Deleting all task logs from gs location [bucket: '%s' prefix: '%s'].\",\n        config.getBucket(),\n        config.getPrefix()\n    );\n\n    long now = timeSupplier.getAsLong();\n    killOlderThan(now);\n  }", "signature": "void killAll()", "full_signature": "@Override public void killAll()", "class_method_signature": "GoogleTaskLogs.killAll()", "testcase": false, "constructor": false, "invocations": ["info", "getBucket", "getPrefix", "getAsLong", "killOlderThan"]}, "repository": {"repo_id": 6358188, "url": "https://github.com/apache/druid", "stars": 9116, "created": "10/23/2012 7:08:07 PM +00:00", "updates": "2020-01-27T21:36:20+00:00", "fork": "False", "license": "licensed"}}