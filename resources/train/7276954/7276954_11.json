{"test_class": {"identifier": "CapacityCommandTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private BlockMasterClient mBlockMasterClient;", "modifier": "private", "type": "BlockMasterClient", "declarator": "mBlockMasterClient", "var_name": "mBlockMasterClient"}], "file": "shell/src/test/java/alluxio/cli/fsadmin/report/CapacityCommandTest.java"}, "test_case": {"identifier": "longCapacity", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void longCapacity() throws IOException {\n    List<WorkerInfo> longInfoList = prepareLongInfoList();\n    Mockito.when(mBlockMasterClient.getWorkerReport(Mockito.any()))\n        .thenReturn(longInfoList);\n\n    try (ByteArrayOutputStream outputStream = new ByteArrayOutputStream();\n         PrintStream printStream = new PrintStream(outputStream, true, \"utf-8\")) {\n      CapacityCommand capacityCommand = new CapacityCommand(mBlockMasterClient,\n          printStream);\n      capacityCommand.generateCapacityReport(GetWorkerReportOptions.defaults());\n      String output = new String(outputStream.toByteArray(), StandardCharsets.UTF_8);\n      // CHECKSTYLE.OFF: LineLengthExceed - Much more readable\n      List<String> expectedOutput = Arrays.asList(\"Capacity information for all workers: \",\n          \"    Total Capacity: 29.80GB\",\n          \"        Tier: MEM  Size: 8.38GB\",\n          \"        Tier: SSD  Size: 4768.37MB\",\n          \"        Tier: HDD  Size: 1907.35MB\",\n          \"        Tier: DOM  Size: 9.31GB\",\n          \"        Tier: RAM  Size: 5.59GB\",\n          \"    Used Capacity: 10.24GB\",\n          \"        Tier: MEM  Size: 3051.76MB\",\n          \"        Tier: SSD  Size: 286.10MB\",\n          \"        Tier: HDD  Size: 1907.35MB\",\n          \"        Tier: DOM  Size: 476.84MB\",\n          \"        Tier: RAM  Size: 4768.37MB\",\n          \"    Used Percentage: 34%\",\n          \"    Free Percentage: 66%\",\n          \"\",\n          \"Worker Name      Last Heartbeat   Storage       Total            MEM           SSD           HDD           DOM           RAM           \",\n          \"216.239.33.96    542              capacity      18.63GB          4768.37MB     4768.37MB     -             9.31GB        -             \",\n          \"                                  used          953.67MB (5%)    190.73MB      286.10MB      -             476.84MB      -             \",\n          \"64.68.90.1       3123             capacity      11.18GB          3814.70MB     -             1907.35MB     -             5.59GB        \",\n          \"                                  used          9.31GB (83%)     2861.02MB     -             1907.35MB     -             4768.37MB     \");\n      // CHECKSTYLE.ON: LineLengthExceed\n      List<String> testOutput = Arrays.asList(output.split(\"\\n\"));\n      Assert.assertThat(testOutput,\n          IsIterableContainingInOrder.contains(expectedOutput.toArray()));\n    }\n  }", "signature": "void longCapacity()", "full_signature": "@Test public void longCapacity()", "class_method_signature": "CapacityCommandTest.longCapacity()", "testcase": true, "constructor": false, "invocations": ["prepareLongInfoList", "thenReturn", "when", "getWorkerReport", "any", "generateCapacityReport", "defaults", "toByteArray", "asList", "asList", "split", "assertThat", "contains", "toArray"]}, "focal_class": {"identifier": "CapacityCommand", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final int INDENT_SIZE = 4;", "modifier": "private static final", "type": "int", "declarator": "INDENT_SIZE = 4", "var_name": "INDENT_SIZE"}, {"original_string": "private BlockMasterClient mBlockMasterClient;", "modifier": "private", "type": "BlockMasterClient", "declarator": "mBlockMasterClient", "var_name": "mBlockMasterClient"}, {"original_string": "private PrintStream mPrintStream;", "modifier": "private", "type": "PrintStream", "declarator": "mPrintStream", "var_name": "mPrintStream"}, {"original_string": "private int mIndentationLevel = 0;", "modifier": "private", "type": "int", "declarator": "mIndentationLevel = 0", "var_name": "mIndentationLevel"}, {"original_string": "private long mSumCapacityBytes;", "modifier": "private", "type": "long", "declarator": "mSumCapacityBytes", "var_name": "mSumCapacityBytes"}, {"original_string": "private long mSumUsedBytes;", "modifier": "private", "type": "long", "declarator": "mSumUsedBytes", "var_name": "mSumUsedBytes"}, {"original_string": "private Map<String, Long> mSumCapacityBytesOnTierMap;", "modifier": "private", "type": "Map<String, Long>", "declarator": "mSumCapacityBytesOnTierMap", "var_name": "mSumCapacityBytesOnTierMap"}, {"original_string": "private Map<String, Long> mSumUsedBytesOnTierMap;", "modifier": "private", "type": "Map<String, Long>", "declarator": "mSumUsedBytesOnTierMap", "var_name": "mSumUsedBytesOnTierMap"}, {"original_string": "private TreeMap<String, Map<String, String>> mCapacityTierInfoMap;", "modifier": "private", "type": "TreeMap<String, Map<String, String>>", "declarator": "mCapacityTierInfoMap", "var_name": "mCapacityTierInfoMap"}, {"original_string": "private Map<String, Map<String, String>> mUsedTierInfoMap;", "modifier": "private", "type": "Map<String, Map<String, String>>", "declarator": "mUsedTierInfoMap", "var_name": "mUsedTierInfoMap"}], "methods": [{"identifier": "CapacityCommand", "parameters": "(BlockMasterClient blockMasterClient, PrintStream printStream)", "modifiers": "public", "return": "", "signature": " CapacityCommand(BlockMasterClient blockMasterClient, PrintStream printStream)", "full_signature": "public  CapacityCommand(BlockMasterClient blockMasterClient, PrintStream printStream)", "class_method_signature": "CapacityCommand.CapacityCommand(BlockMasterClient blockMasterClient, PrintStream printStream)", "testcase": false, "constructor": true}, {"identifier": "run", "parameters": "(CommandLine cl)", "modifiers": "public", "return": "int", "signature": "int run(CommandLine cl)", "full_signature": "public int run(CommandLine cl)", "class_method_signature": "CapacityCommand.run(CommandLine cl)", "testcase": false, "constructor": false}, {"identifier": "generateCapacityReport", "parameters": "(GetWorkerReportOptions options)", "modifiers": "public", "return": "void", "signature": "void generateCapacityReport(GetWorkerReportOptions options)", "full_signature": "public void generateCapacityReport(GetWorkerReportOptions options)", "class_method_signature": "CapacityCommand.generateCapacityReport(GetWorkerReportOptions options)", "testcase": false, "constructor": false}, {"identifier": "collectWorkerInfo", "parameters": "(List<WorkerInfo> workerInfoList)", "modifiers": "private", "return": "void", "signature": "void collectWorkerInfo(List<WorkerInfo> workerInfoList)", "full_signature": "private void collectWorkerInfo(List<WorkerInfo> workerInfoList)", "class_method_signature": "CapacityCommand.collectWorkerInfo(List<WorkerInfo> workerInfoList)", "testcase": false, "constructor": false}, {"identifier": "printAggregatedInfo", "parameters": "(GetWorkerReportOptions options)", "modifiers": "private", "return": "void", "signature": "void printAggregatedInfo(GetWorkerReportOptions options)", "full_signature": "private void printAggregatedInfo(GetWorkerReportOptions options)", "class_method_signature": "CapacityCommand.printAggregatedInfo(GetWorkerReportOptions options)", "testcase": false, "constructor": false}, {"identifier": "printWorkerInfo", "parameters": "(List<WorkerInfo> workerInfoList)", "modifiers": "private", "return": "void", "signature": "void printWorkerInfo(List<WorkerInfo> workerInfoList)", "full_signature": "private void printWorkerInfo(List<WorkerInfo> workerInfoList)", "class_method_signature": "CapacityCommand.printWorkerInfo(List<WorkerInfo> workerInfoList)", "testcase": false, "constructor": false}, {"identifier": "printShortWorkerInfo", "parameters": "(List<WorkerInfo> workerInfoList)", "modifiers": "private", "return": "void", "signature": "void printShortWorkerInfo(List<WorkerInfo> workerInfoList)", "full_signature": "private void printShortWorkerInfo(List<WorkerInfo> workerInfoList)", "class_method_signature": "CapacityCommand.printShortWorkerInfo(List<WorkerInfo> workerInfoList)", "testcase": false, "constructor": false}, {"identifier": "getInfoFormat", "parameters": "(List<WorkerInfo> workerInfoList, boolean isShort)", "modifiers": "private", "return": "String", "signature": "String getInfoFormat(List<WorkerInfo> workerInfoList, boolean isShort)", "full_signature": "private String getInfoFormat(List<WorkerInfo> workerInfoList, boolean isShort)", "class_method_signature": "CapacityCommand.getInfoFormat(List<WorkerInfo> workerInfoList, boolean isShort)", "testcase": false, "constructor": false}, {"identifier": "getOptions", "parameters": "(CommandLine cl)", "modifiers": "private", "return": "GetWorkerReportOptions", "signature": "GetWorkerReportOptions getOptions(CommandLine cl)", "full_signature": "private GetWorkerReportOptions getOptions(CommandLine cl)", "class_method_signature": "CapacityCommand.getOptions(CommandLine cl)", "testcase": false, "constructor": false}, {"identifier": "getWorkerFormattedTierValues", "parameters": "(Map<String, Map<String, String>> map,\n      String workerName)", "modifiers": "private static", "return": "String", "signature": "String getWorkerFormattedTierValues(Map<String, Map<String, String>> map,\n      String workerName)", "full_signature": "private static String getWorkerFormattedTierValues(Map<String, Map<String, String>> map,\n      String workerName)", "class_method_signature": "CapacityCommand.getWorkerFormattedTierValues(Map<String, Map<String, String>> map,\n      String workerName)", "testcase": false, "constructor": false}, {"identifier": "initVariables", "parameters": "()", "modifiers": "private", "return": "void", "signature": "void initVariables()", "full_signature": "private void initVariables()", "class_method_signature": "CapacityCommand.initVariables()", "testcase": false, "constructor": false}, {"identifier": "print", "parameters": "(String text)", "modifiers": "private", "return": "void", "signature": "void print(String text)", "full_signature": "private void print(String text)", "class_method_signature": "CapacityCommand.print(String text)", "testcase": false, "constructor": false}, {"identifier": "getUsage", "parameters": "()", "modifiers": "public static", "return": "String", "signature": "String getUsage()", "full_signature": "public static String getUsage()", "class_method_signature": "CapacityCommand.getUsage()", "testcase": false, "constructor": false}], "file": "shell/src/main/java/alluxio/cli/fsadmin/report/CapacityCommand.java"}, "focal_method": {"identifier": "generateCapacityReport", "parameters": "(GetWorkerReportOptions options)", "modifiers": "public", "return": "void", "body": "public void generateCapacityReport(GetWorkerReportOptions options) throws IOException {\n    List<WorkerInfo> workerInfoList = mBlockMasterClient.getWorkerReport(options);\n    if (workerInfoList.size() == 0) {\n      print(\"No workers found.\");\n      return;\n    }\n    Collections.sort(workerInfoList, new WorkerInfo.LastContactSecComparator());\n\n    collectWorkerInfo(workerInfoList);\n    printAggregatedInfo(options);\n    printWorkerInfo(workerInfoList);\n  }", "signature": "void generateCapacityReport(GetWorkerReportOptions options)", "full_signature": "public void generateCapacityReport(GetWorkerReportOptions options)", "class_method_signature": "CapacityCommand.generateCapacityReport(GetWorkerReportOptions options)", "testcase": false, "constructor": false, "invocations": ["getWorkerReport", "size", "print", "sort", "collectWorkerInfo", "printAggregatedInfo", "printWorkerInfo"]}, "repository": {"repo_id": 7276954, "url": "https://github.com/Alluxio/alluxio", "stars": 4494, "created": "12/21/2012 5:43:46 PM +00:00", "updates": "2020-01-24T20:27:46+00:00", "fork": "False", "license": "licensed"}}