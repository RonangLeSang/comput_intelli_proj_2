{"test_class": {"identifier": "SingleRelatedItemIndexingMessageEventHandlerTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final String DATE = \"2013-05-22T20:31:35\";", "modifier": "private static final", "type": "String", "declarator": "DATE = \"2013-05-22T20:31:35\"", "var_name": "DATE"}, {"original_string": "private static final String PRODUCTID_1 = \"1\";", "modifier": "private static final", "type": "String", "declarator": "PRODUCTID_1 = \"1\"", "var_name": "PRODUCTID_1"}, {"original_string": "private static final String PRODUCTID_2 = \"2\";", "modifier": "private static final", "type": "String", "declarator": "PRODUCTID_2 = \"2\"", "var_name": "PRODUCTID_2"}, {"original_string": "private static final String PRODUCTID_3 = \"3\";", "modifier": "private static final", "type": "String", "declarator": "PRODUCTID_3 = \"3\"", "var_name": "PRODUCTID_3"}, {"original_string": "private static final String SITE = \"amazon\";", "modifier": "private static final", "type": "String", "declarator": "SITE = \"amazon\"", "var_name": "SITE"}, {"original_string": "private static final String CHANNEL = \"uk\";", "modifier": "private static final", "type": "String", "declarator": "CHANNEL = \"uk\"", "var_name": "CHANNEL"}, {"original_string": "private static final String DEPARTMENT = \"electronics\";", "modifier": "private static final", "type": "String", "declarator": "DEPARTMENT = \"electronics\"", "var_name": "DEPARTMENT"}, {"original_string": "private static final String SUBCATEGORY = \"accessories\";", "modifier": "private static final", "type": "String", "declarator": "SUBCATEGORY = \"accessories\"", "var_name": "SUBCATEGORY"}, {"original_string": "RelatedItemIndexingMessageEventHandler handler;", "modifier": "", "type": "RelatedItemIndexingMessageEventHandler", "declarator": "handler", "var_name": "handler"}, {"original_string": "Configuration configuration;", "modifier": "", "type": "Configuration", "declarator": "configuration", "var_name": "configuration"}, {"original_string": "TestRelatedItemStorageRepository repo;", "modifier": "", "type": "TestRelatedItemStorageRepository", "declarator": "repo", "var_name": "repo"}], "file": "app/core/indexing/src/test/java/org/greencheek/related/indexing/requestprocessors/single/disruptor/SingleRelatedItemIndexingMessageEventHandlerTest.java"}, "test_case": {"identifier": "testSendingOneItem", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n    public void testSendingOneItem() {\n        try {\n            handler.onEvent(getMessage(),1,true);\n        } catch(Exception e) {\n            fail();\n        }\n\n        assertEquals(1,repo.getNumberOfCalls());\n        assertEquals(3,repo.getNumberOfProductsSentForStoring());\n    }", "signature": "void testSendingOneItem()", "full_signature": "@Test public void testSendingOneItem()", "class_method_signature": "SingleRelatedItemIndexingMessageEventHandlerTest.testSendingOneItem()", "testcase": true, "constructor": false, "invocations": ["onEvent", "getMessage", "fail", "assertEquals", "getNumberOfCalls", "assertEquals", "getNumberOfProductsSentForStoring"]}, "focal_class": {"identifier": "SingleRelatedItemIndexingMessageEventHandler", "superclass": "", "interfaces": "implements RelatedItemIndexingMessageEventHandler", "fields": [{"original_string": "protected static final Logger log = LoggerFactory.getLogger(SingleRelatedItemIndexingMessageEventHandler.class);", "modifier": "protected static final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(SingleRelatedItemIndexingMessageEventHandler.class)", "var_name": "log"}, {"original_string": "protected final RelatedItemIndexingMessageConverter indexConverter;", "modifier": "protected final", "type": "RelatedItemIndexingMessageConverter", "declarator": "indexConverter", "var_name": "indexConverter"}, {"original_string": "protected final RelatedItemStorageRepository storageRepository;", "modifier": "protected final", "type": "RelatedItemStorageRepository", "declarator": "storageRepository", "var_name": "storageRepository"}, {"original_string": "protected final List<RelatedItem> relatedItems;", "modifier": "protected final", "type": "List<RelatedItem>", "declarator": "relatedItems", "var_name": "relatedItems"}, {"original_string": "protected final RelatedItemStorageLocationMapper locationMapper;", "modifier": "protected final", "type": "RelatedItemStorageLocationMapper", "declarator": "locationMapper", "var_name": "locationMapper"}, {"original_string": "protected final int batchSize;", "modifier": "protected final", "type": "int", "declarator": "batchSize", "var_name": "batchSize"}, {"original_string": "private final int[] count = new int[30];", "modifier": "private final", "type": "int[]", "declarator": "count = new int[30]", "var_name": "count"}, {"original_string": "private static final int COUNTER_POS = 14;", "modifier": "private static final", "type": "int", "declarator": "COUNTER_POS = 14", "var_name": "COUNTER_POS"}, {"original_string": "private volatile boolean shutdown = false;", "modifier": "private volatile", "type": "boolean", "declarator": "shutdown = false", "var_name": "shutdown"}], "methods": [{"identifier": "SingleRelatedItemIndexingMessageEventHandler", "parameters": "(Configuration configuration,\n                                                        RelatedItemIndexingMessageConverter converter,\n                                                        RelatedItemStorageRepository repository,\n                                                        RelatedItemStorageLocationMapper locationMapper)", "modifiers": "public", "return": "", "signature": " SingleRelatedItemIndexingMessageEventHandler(Configuration configuration,\n                                                        RelatedItemIndexingMessageConverter converter,\n                                                        RelatedItemStorageRepository repository,\n                                                        RelatedItemStorageLocationMapper locationMapper)", "full_signature": "public  SingleRelatedItemIndexingMessageEventHandler(Configuration configuration,\n                                                        RelatedItemIndexingMessageConverter converter,\n                                                        RelatedItemStorageRepository repository,\n                                                        RelatedItemStorageLocationMapper locationMapper)", "class_method_signature": "SingleRelatedItemIndexingMessageEventHandler.SingleRelatedItemIndexingMessageEventHandler(Configuration configuration,\n                                                        RelatedItemIndexingMessageConverter converter,\n                                                        RelatedItemStorageRepository repository,\n                                                        RelatedItemStorageLocationMapper locationMapper)", "testcase": false, "constructor": true}, {"identifier": "onEvent", "parameters": "(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "modifiers": "@Override public", "return": "void", "signature": "void onEvent(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "full_signature": "@Override public void onEvent(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "class_method_signature": "SingleRelatedItemIndexingMessageEventHandler.onEvent(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "testcase": false, "constructor": false}, {"identifier": "shutdown", "parameters": "()", "modifiers": "@Override public", "return": "void", "signature": "void shutdown()", "full_signature": "@Override public void shutdown()", "class_method_signature": "SingleRelatedItemIndexingMessageEventHandler.shutdown()", "testcase": false, "constructor": false}], "file": "app/core/indexing/src/main/java/org/greencheek/related/indexing/requestprocessors/single/disruptor/SingleRelatedItemIndexingMessageEventHandler.java"}, "focal_method": {"identifier": "onEvent", "parameters": "(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "modifiers": "@Override public", "return": "void", "body": "@Override\n    public void onEvent(RelatedItemIndexingMessage request, long l, boolean endOfBatch) throws Exception {\n\n\n        if(!request.isValidMessage()) {\n            log.debug(\"Invalid indexing message.  Ignoring message\");\n            return;\n        }\n        if(request.getRelatedItems().getNumberOfRelatedItems()==0) {\n            log.debug(\"Invalid indexing message, no related products.  Ignoring message\");\n            request.setValidMessage(false);\n            return;\n        }\n\n        try {\n\n            RelatedItem[] products = indexConverter.convertFrom(request);\n            this.count[COUNTER_POS]-=products.length;\n            for(RelatedItem p : products) {\n                relatedItems.add(p);\n            }\n\n            if(endOfBatch || this.count[COUNTER_POS]<1) {\n                try {\n                    log.debug(\"Sending indexing requests to the storage repository\");\n                    try {\n                        storageRepository.store(locationMapper, relatedItems);\n                    } catch(Exception e) {\n                        log.warn(\"Exception calling storage repository for related products:{}\", products, e);\n                    }\n                }\n                finally {\n                    this.count[COUNTER_POS] = batchSize;\n                    relatedItems.clear();\n                }\n            }\n        } finally {\n            request.setValidMessage(false);\n        }\n\n\n    }", "signature": "void onEvent(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "full_signature": "@Override public void onEvent(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "class_method_signature": "SingleRelatedItemIndexingMessageEventHandler.onEvent(RelatedItemIndexingMessage request, long l, boolean endOfBatch)", "testcase": false, "constructor": false, "invocations": ["isValidMessage", "debug", "getNumberOfRelatedItems", "getRelatedItems", "debug", "setValidMessage", "convertFrom", "add", "debug", "store", "warn", "clear", "setValidMessage"]}, "repository": {"repo_id": 10422484, "url": "https://github.com/tootedom/related", "language": "Java", "is_fork": false, "fork_count": 1, "stargazer_count": 14, "size": 20852, "license": "licensed"}}