{"test_class": {"identifier": "SortedLogRecoveryTest", "superclass": "", "interfaces": "", "fields": [{"original_string": "static final KeyExtent extent = new KeyExtent(TableId.of(\"table\"), null, null);", "modifier": "static final", "type": "KeyExtent", "declarator": "extent = new KeyExtent(TableId.of(\"table\"), null, null)", "var_name": "extent"}, {"original_string": "static final Text cf = new Text(\"cf\");", "modifier": "static final", "type": "Text", "declarator": "cf = new Text(\"cf\")", "var_name": "cf"}, {"original_string": "static final Text cq = new Text(\"cq\");", "modifier": "static final", "type": "Text", "declarator": "cq = new Text(\"cq\")", "var_name": "cq"}, {"original_string": "static final Value value = new Value(\"value\");", "modifier": "static final", "type": "Value", "declarator": "value = new Value(\"value\")", "var_name": "value"}, {"original_string": "@Rule\n  public TemporaryFolder tempFolder =\n      new TemporaryFolder(new File(System.getProperty(\"user.dir\") + \"/target\"));", "modifier": "@Rule\n  public", "type": "TemporaryFolder", "declarator": "tempFolder =\n      new TemporaryFolder(new File(System.getProperty(\"user.dir\") + \"/target\"))", "var_name": "tempFolder"}], "file": "server/tserver/src/test/java/org/apache/accumulo/tserver/log/SortedLogRecoveryTest.java"}, "test_case": {"identifier": "testEmpty", "parameters": "()", "modifiers": "@Test public", "return": "void", "body": "@Test\n  public void testEmpty() throws IOException {\n    // Create a test log\n    KeyValue[] entries =\n        {createKeyValue(OPEN, 0, -1, \"1\"), createKeyValue(DEFINE_TABLET, 1, 1, extent),};\n    Map<String,KeyValue[]> logs = new TreeMap<>();\n    logs.put(\"testlog\", entries);\n    // Recover\n    List<Mutation> mutations = recover(logs, extent);\n    // Verify recovered data\n    assertEquals(0, mutations.size());\n\n  }", "signature": "void testEmpty()", "full_signature": "@Test public void testEmpty()", "class_method_signature": "SortedLogRecoveryTest.testEmpty()", "testcase": true, "constructor": false, "invocations": ["createKeyValue", "createKeyValue", "put", "recover", "assertEquals", "size"]}, "focal_class": {"identifier": "SortedLogRecovery", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static final Logger log = LoggerFactory.getLogger(SortedLogRecovery.class);", "modifier": "private static final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(SortedLogRecovery.class)", "var_name": "log"}, {"original_string": "private VolumeManager fs;", "modifier": "private", "type": "VolumeManager", "declarator": "fs", "var_name": "fs"}], "methods": [{"identifier": "SortedLogRecovery", "parameters": "(VolumeManager fs)", "modifiers": "public", "return": "", "signature": " SortedLogRecovery(VolumeManager fs)", "full_signature": "public  SortedLogRecovery(VolumeManager fs)", "class_method_signature": "SortedLogRecovery.SortedLogRecovery(VolumeManager fs)", "testcase": false, "constructor": true}, {"identifier": "maxKey", "parameters": "(LogEvents event)", "modifiers": "static", "return": "LogFileKey", "signature": "LogFileKey maxKey(LogEvents event)", "full_signature": "static LogFileKey maxKey(LogEvents event)", "class_method_signature": "SortedLogRecovery.maxKey(LogEvents event)", "testcase": false, "constructor": false}, {"identifier": "maxKey", "parameters": "(LogEvents event, int tabletId)", "modifiers": "static", "return": "LogFileKey", "signature": "LogFileKey maxKey(LogEvents event, int tabletId)", "full_signature": "static LogFileKey maxKey(LogEvents event, int tabletId)", "class_method_signature": "SortedLogRecovery.maxKey(LogEvents event, int tabletId)", "testcase": false, "constructor": false}, {"identifier": "minKey", "parameters": "(LogEvents event)", "modifiers": "static", "return": "LogFileKey", "signature": "LogFileKey minKey(LogEvents event)", "full_signature": "static LogFileKey minKey(LogEvents event)", "class_method_signature": "SortedLogRecovery.minKey(LogEvents event)", "testcase": false, "constructor": false}, {"identifier": "minKey", "parameters": "(LogEvents event, int tabletId)", "modifiers": "static", "return": "LogFileKey", "signature": "LogFileKey minKey(LogEvents event, int tabletId)", "full_signature": "static LogFileKey minKey(LogEvents event, int tabletId)", "class_method_signature": "SortedLogRecovery.minKey(LogEvents event, int tabletId)", "testcase": false, "constructor": false}, {"identifier": "findMaxTabletId", "parameters": "(KeyExtent extent, List<Path> recoveryLogs)", "modifiers": "private", "return": "int", "signature": "int findMaxTabletId(KeyExtent extent, List<Path> recoveryLogs)", "full_signature": "private int findMaxTabletId(KeyExtent extent, List<Path> recoveryLogs)", "class_method_signature": "SortedLogRecovery.findMaxTabletId(KeyExtent extent, List<Path> recoveryLogs)", "testcase": false, "constructor": false}, {"identifier": "findLogsThatDefineTablet", "parameters": "(KeyExtent extent,\n      List<Path> recoveryLogs)", "modifiers": "private", "return": "Entry<Integer,List<Path>>", "signature": "Entry<Integer,List<Path>> findLogsThatDefineTablet(KeyExtent extent,\n      List<Path> recoveryLogs)", "full_signature": "private Entry<Integer,List<Path>> findLogsThatDefineTablet(KeyExtent extent,\n      List<Path> recoveryLogs)", "class_method_signature": "SortedLogRecovery.findLogsThatDefineTablet(KeyExtent extent,\n      List<Path> recoveryLogs)", "testcase": false, "constructor": false}, {"identifier": "getPathSuffix", "parameters": "(String pathString)", "modifiers": "private", "return": "String", "signature": "String getPathSuffix(String pathString)", "full_signature": "private String getPathSuffix(String pathString)", "class_method_signature": "SortedLogRecovery.getPathSuffix(String pathString)", "testcase": false, "constructor": false}, {"identifier": "findRecoverySeq", "parameters": "(List<Path> recoveryLogs, Set<String> tabletFiles, int tabletId)", "modifiers": "private", "return": "long", "signature": "long findRecoverySeq(List<Path> recoveryLogs, Set<String> tabletFiles, int tabletId)", "full_signature": "private long findRecoverySeq(List<Path> recoveryLogs, Set<String> tabletFiles, int tabletId)", "class_method_signature": "SortedLogRecovery.findRecoverySeq(List<Path> recoveryLogs, Set<String> tabletFiles, int tabletId)", "testcase": false, "constructor": false}, {"identifier": "playbackMutations", "parameters": "(List<Path> recoveryLogs, MutationReceiver mr, int tabletId,\n      long recoverySeq)", "modifiers": "private", "return": "void", "signature": "void playbackMutations(List<Path> recoveryLogs, MutationReceiver mr, int tabletId,\n      long recoverySeq)", "full_signature": "private void playbackMutations(List<Path> recoveryLogs, MutationReceiver mr, int tabletId,\n      long recoverySeq)", "class_method_signature": "SortedLogRecovery.playbackMutations(List<Path> recoveryLogs, MutationReceiver mr, int tabletId,\n      long recoverySeq)", "testcase": false, "constructor": false}, {"identifier": "asNames", "parameters": "(List<Path> recoveryLogs)", "modifiers": "", "return": "Collection<String>", "signature": "Collection<String> asNames(List<Path> recoveryLogs)", "full_signature": " Collection<String> asNames(List<Path> recoveryLogs)", "class_method_signature": "SortedLogRecovery.asNames(List<Path> recoveryLogs)", "testcase": false, "constructor": false}, {"identifier": "recover", "parameters": "(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "modifiers": "public", "return": "void", "signature": "void recover(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "full_signature": "public void recover(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "class_method_signature": "SortedLogRecovery.recover(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "testcase": false, "constructor": false}], "file": "server/tserver/src/main/java/org/apache/accumulo/tserver/log/SortedLogRecovery.java"}, "focal_method": {"identifier": "recover", "parameters": "(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "modifiers": "public", "return": "void", "body": "public void recover(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr) throws IOException {\n\n    Entry<Integer,List<Path>> maxEntry = findLogsThatDefineTablet(extent, recoveryLogs);\n\n    // A tablet may leave a tserver and then come back, in which case it would have a different and\n    // higher tablet id. Only want to consider events in the log related to the last time the tablet\n    // was loaded.\n    int tabletId = maxEntry.getKey();\n    List<Path> logsThatDefineTablet = maxEntry.getValue();\n\n    if (tabletId == -1) {\n      log.info(\"Tablet {} is not defined in recovery logs {} \", extent, asNames(recoveryLogs));\n      return;\n    } else {\n      log.info(\"Found {} of {} logs with max id {} for tablet {}\", logsThatDefineTablet.size(),\n          recoveryLogs.size(), tabletId, extent);\n    }\n\n    // Find the seq # for the last compaction that started and finished\n    long recoverySeq = findRecoverySeq(logsThatDefineTablet, tabletFiles, tabletId);\n\n    log.info(\"Recovering mutations, tablet:{} tabletId:{} seq:{} logs:{}\", extent, tabletId,\n        recoverySeq, asNames(logsThatDefineTablet));\n\n    // Replay all mutations that were written after the last successful compaction started.\n    playbackMutations(logsThatDefineTablet, mr, tabletId, recoverySeq);\n  }", "signature": "void recover(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "full_signature": "public void recover(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "class_method_signature": "SortedLogRecovery.recover(KeyExtent extent, List<Path> recoveryLogs, Set<String> tabletFiles,\n      MutationReceiver mr)", "testcase": false, "constructor": false, "invocations": ["findLogsThatDefineTablet", "getKey", "getValue", "info", "asNames", "info", "size", "size", "findRecoverySeq", "info", "asNames", "playbackMutations"]}, "repository": {"repo_id": 2524488, "url": "https://github.com/apache/accumulo", "stars": 779, "created": "10/6/2011 7:00:09 AM +00:00", "updates": "2020-01-24T17:34:30+00:00", "fork": "False", "license": "licensed"}}