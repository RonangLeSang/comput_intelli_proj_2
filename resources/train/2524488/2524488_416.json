{"test_class": {"identifier": "Upgrader9to10Test", "superclass": "", "interfaces": "", "fields": [{"original_string": "private static Logger log = LoggerFactory.getLogger(Upgrader9to10Test.class);", "modifier": "private static", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(Upgrader9to10Test.class)", "var_name": "log"}, {"original_string": "private static final String VOL_PROP = \"hdfs://nn1:8020/accumulo\";", "modifier": "private static final", "type": "String", "declarator": "VOL_PROP = \"hdfs://nn1:8020/accumulo\"", "var_name": "VOL_PROP"}, {"original_string": "String tableName = Ample.DataLevel.USER.metaTable();", "modifier": "", "type": "String", "declarator": "tableName = Ample.DataLevel.USER.metaTable()", "var_name": "tableName"}, {"original_string": "String volumeUpgrade = \"file:///accumulo\";", "modifier": "", "type": "String", "declarator": "volumeUpgrade = \"file:///accumulo\"", "var_name": "volumeUpgrade"}], "file": "server/manager/src/test/java/org/apache/accumulo/master/upgrade/Upgrader9to10Test.java"}, "test_case": {"identifier": "testBadRelativeDeleteTooLong", "parameters": "()", "modifiers": "@Test(expected = IllegalStateException.class) public", "return": "void", "body": "@Test(expected = IllegalStateException.class)\n  public void testBadRelativeDeleteTooLong() throws Exception {\n    Upgrader9to10.resolveRelativeDelete(\"/5a/5a/t-0005/F0009.rf\", VOL_PROP);\n  }", "signature": "void testBadRelativeDeleteTooLong()", "full_signature": "@Test(expected = IllegalStateException.class) public void testBadRelativeDeleteTooLong()", "class_method_signature": "Upgrader9to10Test.testBadRelativeDeleteTooLong()", "testcase": true, "constructor": false, "invocations": ["resolveRelativeDelete"]}, "focal_class": {"identifier": "Upgrader9to10", "superclass": "", "interfaces": "implements Upgrader", "fields": [{"original_string": "private static final Logger log = LoggerFactory.getLogger(Upgrader9to10.class);", "modifier": "private static final", "type": "Logger", "declarator": "log = LoggerFactory.getLogger(Upgrader9to10.class)", "var_name": "log"}, {"original_string": "public static final String ZROOT_TABLET_LOCATION = ZROOT_TABLET + \"/location\";", "modifier": "public static final", "type": "String", "declarator": "ZROOT_TABLET_LOCATION = ZROOT_TABLET + \"/location\"", "var_name": "ZROOT_TABLET_LOCATION"}, {"original_string": "public static final String ZROOT_TABLET_FUTURE_LOCATION = ZROOT_TABLET + \"/future_location\";", "modifier": "public static final", "type": "String", "declarator": "ZROOT_TABLET_FUTURE_LOCATION = ZROOT_TABLET + \"/future_location\"", "var_name": "ZROOT_TABLET_FUTURE_LOCATION"}, {"original_string": "public static final String ZROOT_TABLET_LAST_LOCATION = ZROOT_TABLET + \"/lastlocation\";", "modifier": "public static final", "type": "String", "declarator": "ZROOT_TABLET_LAST_LOCATION = ZROOT_TABLET + \"/lastlocation\"", "var_name": "ZROOT_TABLET_LAST_LOCATION"}, {"original_string": "public static final String ZROOT_TABLET_WALOGS = ZROOT_TABLET + \"/walogs\";", "modifier": "public static final", "type": "String", "declarator": "ZROOT_TABLET_WALOGS = ZROOT_TABLET + \"/walogs\"", "var_name": "ZROOT_TABLET_WALOGS"}, {"original_string": "public static final String ZROOT_TABLET_CURRENT_LOGS = ZROOT_TABLET + \"/current_logs\";", "modifier": "public static final", "type": "String", "declarator": "ZROOT_TABLET_CURRENT_LOGS = ZROOT_TABLET + \"/current_logs\"", "var_name": "ZROOT_TABLET_CURRENT_LOGS"}, {"original_string": "public static final String ZROOT_TABLET_PATH = ZROOT_TABLET + \"/dir\";", "modifier": "public static final", "type": "String", "declarator": "ZROOT_TABLET_PATH = ZROOT_TABLET + \"/dir\"", "var_name": "ZROOT_TABLET_PATH"}, {"original_string": "public static final Value UPGRADED = SkewedKeyValue.NAME;", "modifier": "public static final", "type": "Value", "declarator": "UPGRADED = SkewedKeyValue.NAME", "var_name": "UPGRADED"}, {"original_string": "public static final String OLD_DELETE_PREFIX = \"~del\";", "modifier": "public static final", "type": "String", "declarator": "OLD_DELETE_PREFIX = \"~del\"", "var_name": "OLD_DELETE_PREFIX"}, {"original_string": "public static final long CANDIDATE_BATCH_SIZE = 4_000_000;", "modifier": "public static final", "type": "long", "declarator": "CANDIDATE_BATCH_SIZE = 4_000_000", "var_name": "CANDIDATE_BATCH_SIZE"}], "methods": [{"identifier": "upgradeZookeeper", "parameters": "(ServerContext ctx)", "modifiers": "@Override public", "return": "void", "signature": "void upgradeZookeeper(ServerContext ctx)", "full_signature": "@Override public void upgradeZookeeper(ServerContext ctx)", "class_method_signature": "Upgrader9to10.upgradeZookeeper(ServerContext ctx)", "testcase": false, "constructor": false}, {"identifier": "upgradeRoot", "parameters": "(ServerContext ctx)", "modifiers": "@Override public", "return": "void", "signature": "void upgradeRoot(ServerContext ctx)", "full_signature": "@Override public void upgradeRoot(ServerContext ctx)", "class_method_signature": "Upgrader9to10.upgradeRoot(ServerContext ctx)", "testcase": false, "constructor": false}, {"identifier": "upgradeMetadata", "parameters": "(ServerContext ctx)", "modifiers": "@Override public", "return": "void", "signature": "void upgradeMetadata(ServerContext ctx)", "full_signature": "@Override public void upgradeMetadata(ServerContext ctx)", "class_method_signature": "Upgrader9to10.upgradeMetadata(ServerContext ctx)", "testcase": false, "constructor": false}, {"identifier": "setMetaTableProps", "parameters": "(ServerContext ctx)", "modifiers": "private", "return": "void", "signature": "void setMetaTableProps(ServerContext ctx)", "full_signature": "private void setMetaTableProps(ServerContext ctx)", "class_method_signature": "Upgrader9to10.setMetaTableProps(ServerContext ctx)", "testcase": false, "constructor": false}, {"identifier": "upgradeRootTabletMetadata", "parameters": "(ServerContext ctx)", "modifiers": "private", "return": "void", "signature": "void upgradeRootTabletMetadata(ServerContext ctx)", "full_signature": "private void upgradeRootTabletMetadata(ServerContext ctx)", "class_method_signature": "Upgrader9to10.upgradeRootTabletMetadata(ServerContext ctx)", "testcase": false, "constructor": false}, {"identifier": "getLocation", "parameters": "(ServerContext ctx, String relpath)", "modifiers": "protected", "return": "TServerInstance", "signature": "TServerInstance getLocation(ServerContext ctx, String relpath)", "full_signature": "protected TServerInstance getLocation(ServerContext ctx, String relpath)", "class_method_signature": "Upgrader9to10.getLocation(ServerContext ctx, String relpath)", "testcase": false, "constructor": false}, {"identifier": "getRootLogEntries", "parameters": "(ServerContext context)", "modifiers": "static", "return": "List<LogEntry>", "signature": "List<LogEntry> getRootLogEntries(ServerContext context)", "full_signature": "static List<LogEntry> getRootLogEntries(ServerContext context)", "class_method_signature": "Upgrader9to10.getRootLogEntries(ServerContext context)", "testcase": false, "constructor": false}, {"identifier": "getFromZK", "parameters": "(ServerContext ctx, String relpath)", "modifiers": "private", "return": "String", "signature": "String getFromZK(ServerContext ctx, String relpath)", "full_signature": "private String getFromZK(ServerContext ctx, String relpath)", "class_method_signature": "Upgrader9to10.getFromZK(ServerContext ctx, String relpath)", "testcase": false, "constructor": false}, {"identifier": "delete", "parameters": "(ServerContext ctx, String relpath)", "modifiers": "private", "return": "void", "signature": "void delete(ServerContext ctx, String relpath)", "full_signature": "private void delete(ServerContext ctx, String relpath)", "class_method_signature": "Upgrader9to10.delete(ServerContext ctx, String relpath)", "testcase": false, "constructor": false}, {"identifier": "computeRootTabletTime", "parameters": "(ServerContext context, Collection<String> goodPaths)", "modifiers": "", "return": "MetadataTime", "signature": "MetadataTime computeRootTabletTime(ServerContext context, Collection<String> goodPaths)", "full_signature": " MetadataTime computeRootTabletTime(ServerContext context, Collection<String> goodPaths)", "class_method_signature": "Upgrader9to10.computeRootTabletTime(ServerContext context, Collection<String> goodPaths)", "testcase": false, "constructor": false}, {"identifier": "cleanupRootTabletFiles", "parameters": "(VolumeManager fs, String dir)", "modifiers": "static", "return": "Map<String,DataFileValue>", "signature": "Map<String,DataFileValue> cleanupRootTabletFiles(VolumeManager fs, String dir)", "full_signature": "static Map<String,DataFileValue> cleanupRootTabletFiles(VolumeManager fs, String dir)", "class_method_signature": "Upgrader9to10.cleanupRootTabletFiles(VolumeManager fs, String dir)", "testcase": false, "constructor": false}, {"identifier": "upgradeFileDeletes", "parameters": "(ServerContext ctx, Ample.DataLevel level)", "modifiers": "public", "return": "void", "signature": "void upgradeFileDeletes(ServerContext ctx, Ample.DataLevel level)", "full_signature": "public void upgradeFileDeletes(ServerContext ctx, Ample.DataLevel level)", "class_method_signature": "Upgrader9to10.upgradeFileDeletes(ServerContext ctx, Ample.DataLevel level)", "testcase": false, "constructor": false}, {"identifier": "switchToAllVolumes", "parameters": "(Path olddelete)", "modifiers": "@VisibleForTesting static", "return": "String", "signature": "String switchToAllVolumes(Path olddelete)", "full_signature": "@VisibleForTesting static String switchToAllVolumes(Path olddelete)", "class_method_signature": "Upgrader9to10.switchToAllVolumes(Path olddelete)", "testcase": false, "constructor": false}, {"identifier": "getOldCandidates", "parameters": "(ServerContext ctx, String tableName)", "modifiers": "private", "return": "Iterator<String>", "signature": "Iterator<String> getOldCandidates(ServerContext ctx, String tableName)", "full_signature": "private Iterator<String> getOldCandidates(ServerContext ctx, String tableName)", "class_method_signature": "Upgrader9to10.getOldCandidates(ServerContext ctx, String tableName)", "testcase": false, "constructor": false}, {"identifier": "readCandidatesInBatch", "parameters": "(Iterator<String> candidates)", "modifiers": "private", "return": "List<String>", "signature": "List<String> readCandidatesInBatch(Iterator<String> candidates)", "full_signature": "private List<String> readCandidatesInBatch(Iterator<String> candidates)", "class_method_signature": "Upgrader9to10.readCandidatesInBatch(Iterator<String> candidates)", "testcase": false, "constructor": false}, {"identifier": "deleteOldDeleteMutation", "parameters": "(final String delete)", "modifiers": "private", "return": "Mutation", "signature": "Mutation deleteOldDeleteMutation(final String delete)", "full_signature": "private Mutation deleteOldDeleteMutation(final String delete)", "class_method_signature": "Upgrader9to10.deleteOldDeleteMutation(final String delete)", "testcase": false, "constructor": false}, {"identifier": "upgradeDirColumns", "parameters": "(ServerContext ctx, Ample.DataLevel level)", "modifiers": "public", "return": "void", "signature": "void upgradeDirColumns(ServerContext ctx, Ample.DataLevel level)", "full_signature": "public void upgradeDirColumns(ServerContext ctx, Ample.DataLevel level)", "class_method_signature": "Upgrader9to10.upgradeDirColumns(ServerContext ctx, Ample.DataLevel level)", "testcase": false, "constructor": false}, {"identifier": "upgradeDirColumn", "parameters": "(String dir)", "modifiers": "public static", "return": "String", "signature": "String upgradeDirColumn(String dir)", "full_signature": "public static String upgradeDirColumn(String dir)", "class_method_signature": "Upgrader9to10.upgradeDirColumn(String dir)", "testcase": false, "constructor": false}, {"identifier": "upgradeRelativePaths", "parameters": "(ServerContext ctx, Ample.DataLevel level)", "modifiers": "public static", "return": "void", "signature": "void upgradeRelativePaths(ServerContext ctx, Ample.DataLevel level)", "full_signature": "public static void upgradeRelativePaths(ServerContext ctx, Ample.DataLevel level)", "class_method_signature": "Upgrader9to10.upgradeRelativePaths(ServerContext ctx, Ample.DataLevel level)", "testcase": false, "constructor": false}, {"identifier": "replaceRelativePaths", "parameters": "(AccumuloClient c, VolumeManager fs, String tableName,\n      String upgradeProperty)", "modifiers": "public static", "return": "void", "signature": "void replaceRelativePaths(AccumuloClient c, VolumeManager fs, String tableName,\n      String upgradeProperty)", "full_signature": "public static void replaceRelativePaths(AccumuloClient c, VolumeManager fs, String tableName,\n      String upgradeProperty)", "class_method_signature": "Upgrader9to10.replaceRelativePaths(AccumuloClient c, VolumeManager fs, String tableName,\n      String upgradeProperty)", "testcase": false, "constructor": false}, {"identifier": "checkForRelativePaths", "parameters": "(AccumuloClient client, VolumeManager fs,\n      String tableName, String upgradeProperty)", "modifiers": "public static", "return": "boolean", "signature": "boolean checkForRelativePaths(AccumuloClient client, VolumeManager fs,\n      String tableName, String upgradeProperty)", "full_signature": "public static boolean checkForRelativePaths(AccumuloClient client, VolumeManager fs,\n      String tableName, String upgradeProperty)", "class_method_signature": "Upgrader9to10.checkForRelativePaths(AccumuloClient client, VolumeManager fs,\n      String tableName, String upgradeProperty)", "testcase": false, "constructor": false}, {"identifier": "resolveRelativePath", "parameters": "(String metadataEntry, Key key)", "modifiers": "private static", "return": "Path", "signature": "Path resolveRelativePath(String metadataEntry, Key key)", "full_signature": "private static Path resolveRelativePath(String metadataEntry, Key key)", "class_method_signature": "Upgrader9to10.resolveRelativePath(String metadataEntry, Key key)", "testcase": false, "constructor": false}, {"identifier": "resolveRelativeDelete", "parameters": "(String oldDelete, String upgradeProperty)", "modifiers": "static", "return": "Path", "signature": "Path resolveRelativeDelete(String oldDelete, String upgradeProperty)", "full_signature": "static Path resolveRelativeDelete(String oldDelete, String upgradeProperty)", "class_method_signature": "Upgrader9to10.resolveRelativeDelete(String oldDelete, String upgradeProperty)", "testcase": false, "constructor": false}], "file": "server/manager/src/main/java/org/apache/accumulo/master/upgrade/Upgrader9to10.java"}, "focal_method": {"identifier": "resolveRelativeDelete", "parameters": "(String oldDelete, String upgradeProperty)", "modifiers": "static", "return": "Path", "body": "static Path resolveRelativeDelete(String oldDelete, String upgradeProperty) {\n    Path pathNoVolume = VolumeManager.FileType.TABLE.removeVolume(new Path(oldDelete));\n    Path pathToCheck = new Path(oldDelete);\n\n    // if the volume was removed properly, the path is absolute so return, otherwise\n    // it is a relative path so proceed with more checks\n    if (pathNoVolume != null)\n      return pathToCheck;\n\n    // A relative path directory of the form \"/tableId/tabletDir\" will have depth == 2\n    // A relative path file of the form \"/tableId/tabletDir/file\" will have depth == 3\n    Preconditions.checkState(\n        oldDelete.startsWith(\"/\") && (pathToCheck.depth() == 2 || pathToCheck.depth() == 3),\n        \"Unrecognized relative delete marker {}\", oldDelete);\n\n    // found relative paths so verify the property used to build the absolute paths\n    if (upgradeProperty == null || upgradeProperty.isBlank()) {\n      throw new IllegalArgumentException(\n          \"Missing required property \" + Property.INSTANCE_VOLUMES_UPGRADE_RELATIVE.getKey());\n    }\n    return new Path(upgradeProperty, VolumeManager.FileType.TABLE.getDirectory() + oldDelete);\n  }", "signature": "Path resolveRelativeDelete(String oldDelete, String upgradeProperty)", "full_signature": "static Path resolveRelativeDelete(String oldDelete, String upgradeProperty)", "class_method_signature": "Upgrader9to10.resolveRelativeDelete(String oldDelete, String upgradeProperty)", "testcase": false, "constructor": false, "invocations": ["removeVolume", "checkState", "startsWith", "depth", "depth", "isBlank", "getKey", "getDirectory"]}, "repository": {"repo_id": 2524488, "url": "https://github.com/apache/accumulo", "stars": 779, "created": "10/6/2011 7:00:09 AM +00:00", "updates": "2020-01-24T17:34:30+00:00", "fork": "False", "license": "licensed"}}